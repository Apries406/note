# æ·±æµ…æ‹·è´

## ä»€ä¹ˆæ˜¯æ·±æµ…æ‹·è´
### æµ…æ‹·è´
*æµ…æ‹·è´*æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½†æ˜¯è¯¥æ–°å¯¹è±¡çš„å…ƒç´ ä»ç„¶æ˜¯åŸå§‹å¯¹è±¡çš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨é’±æ‹·è´ä¸­ï¼Œè‹¥ï¼š
- å±æ€§æ˜¯**åŸºæœ¬ç±»å‹**ï¼šæ‹·è´åŸºæœ¬ç±»å‹çš„**å€¼**
- å±æ€§æ˜¯**å¼•ç”¨ç±»å‹**ï¼šæ‹·è´**å†…å­˜åœ°å€**ï¼Œæ–°å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡å…±äº«å†…å­˜åœ°å€ï¼Œå½“ä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦ä¸€ä¸ªå¯¹è±¡ä¹Ÿä¼šå—åˆ°å½±å“ã€‚
å› æ­¤ï¼Œæµ…æ‹·è´é€šå¸¸é€‚ç”¨äºç®€å•çš„æ•°æ®ç»“æ„ã€‚
#### æµ…æ‹·è´ä¸èµ‹å€¼æœ‰ä½•åŒºåˆ«ï¼Ÿ
>[!info]
>**èµ‹å€¼**: å½“æˆ‘ä»¬æŠŠä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªæ–°å¯¹è±¡æ—¶ï¼Œæ–°å¯¹è±¡å¾—åˆ°çš„å…¶å®æ˜¯åŸå§‹å¯¹è±¡åœ¨æ ˆä¸­çš„åœ°å€ï¼Œè€Œä¸æ˜¯å †ä¸­çš„æ•°æ®å€¼ã€‚ä¹Ÿå°±æ˜¯ä¸¤ä¸ªå¯¹è±¡å…¶å®æŒ‡å‘åŒä¸€ä¸ªç©ºé—´ï¼Œæ— è®ºå“ªä¸ªå¯¹è±¡ä¿®æ”¹è‡ªå·±çš„å±æ€§ï¼Œå¦ä¸€ä¸ªå¯¹è±¡ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚å°±åƒä¸¤ä¸ªäººæ‹¿äº†åŒä¸€ä¸ªæˆ¿é—´çš„é’¥åŒ™ï¼Œæ— è®ºå“ªä¸ªäººæ”¹å˜äº†å±‹å†…çš„å¸ƒå±€ï¼Œéƒ½ä¼šå¯¹æˆ¿é—´é€ æˆå½±å“ã€‚
>
>**æµ…æ‹·è´**: å½“æˆ‘ä»¬ä»¥æµ…æ‹·è´æ–¹æ³•å¤åˆ¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šåœ¨å †ä¸­é‡æ–°åˆ†é…å†…å­˜ã€‚æ‹·è´å‰åï¼Œæ–°å¯¹è±¡ä¸åŸå§‹å¯¹è±¡çš„ä¸­å±äºåŸºæœ¬æ•°æ®ç±»å‹çš„éƒ¨åˆ†äº’ä¸å½±å“ï¼Œä½†æ˜¯å±äºå¼•ç”¨ç±»å‹çš„æ•°æ®ç±»å‹ä»ç„¶å…±äº«åŒä¸€å—å†…å­˜ï¼Œå› æ­¤ä¾ç„¶ä¼šå½±å“ã€‚

```javascript
const obj = {
	name: 'apries',
	info: [20, 'Male', 'ChengDu'],
}

const obj1 = obj
obj1.name = 'Apries'
obj1.info[2] = 'China'

console.log(obj) // { name: 'Apries', info: [ 20, 'Male', 'China' ] }
console.log(obj1) // { name: 'Apries', info: [ 20, 'Male', 'China' ] }

const obj2 = shallowCopy(obj)

obj2.name = 'apries'
obj2.info[2] = 'ChengDu'

console.log(obj) // { name: 'Apries', info: [ 20, 'Male', 'ChengDu' ] }
console.log(obj1) // { name: 'Apries', info: [ 20, 'Male', 'ChengDu' ] }
console.log(obj2) // { name: 'apries', info: [ 20, 'Male', 'ChengDu' ] }

function shallowCopy(obj) {
	let copied = {}
	for (let key in obj) {
		if (obj.hasOwnProperty(key)) {
			copied[key] = obj[key]
		}
	}

	return copied
}
```

### æ·±æ‹·è´
*æ·±æ‹·è´*æ˜¯æŒ‡åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ‹·è´å‰åï¼Œæ–°å¯¹è±¡ä¸åŸå§‹å¯¹è±¡çš„å±æ€§å®Œå…¨ç‹¬ç«‹ï¼Œä¸å­˜åœ¨å¼•ç”¨å…³ç³»ã€‚åªæ˜¯æ–°å¯¹è±¡ä¸åŸå§‹å¯¹è±¡çš„å±æ€§å€¼å®Œå…¨ä¸€æ ·ã€‚æ— è®ºæ€æ ·ä¿®æ”¹è‡ªèº«å±æ€§ï¼Œå¦ä¸€ä¸ªå¯¹è±¡éƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚
å› æ­¤ï¼Œæ·±æ‹·è´é€‚ç”¨äºå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¦‚*åµŒå¥—çš„å¯¹è±¡*å’Œ*å¤šç»´æ•°ç»„*ã€‚
## å¦‚ä½•å®ç°ä¸€ä¸ªæµ…æ‹·è´ï¼Ÿ
### Object.assign()
>[!info]
>`Object.assign(target, ...sources)`
å¦‚æœç›®æ ‡å¯¹è±¡ä¸æºå¯¹è±¡å…·æœ‰ç›¸åŒçš„å±æ€§åï¼Œåˆ™ç›®æ ‡å¯¹è±¡ä¸­çš„å±æ€§å°†è¢«æºå¯¹è±¡ä¸­çš„å±æ€§è¦†ç›–ã€‚
å…¶å¤–ï¼Œä¼šå°†æºå¯¹è±¡çš„**å¯æšä¸¾çš„**è‡ªæœ‰å±æ€§æ‹·è´åˆ°é¶å¯¹è±¡ã€‚
è¯¥æ–¹æ³•åœ¨æºå¯¹è±¡ä¸Šä½¿ç”¨`[[Get]]`ï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¸Šä½¿ç”¨`[[Set]]`ï¼Œå› æ­¤å®ƒä¼šè°ƒç”¨`getter`å’Œ`setter`ã€‚æ•…å®ƒå¯¹å±æ€§èµ‹å€¼ï¼Œè€Œä¸ä»…ä»…æ˜¯èµ‹å€¼æˆ–å®šä¹‰æ–°çš„å±æ€§ã€‚å¦‚æœè¦å°†å±æ€§å®šä¹‰ï¼ˆåŒ…æ‹¬å®ƒä»¬çš„å¯æšä¸¾æ€§ï¼‰å¤åˆ¶åˆ°åŸå‹ä¸­ï¼Œåˆ™åº”æ”¹ç”¨ `Object.getOwnPropertyDescriptor()` å’Œ `Object.defineProperty()` æ–¹æ³•ã€‚
`å­—ç¬¦ä¸²`å’Œ `Symbol` ç±»å‹å±æ€§éƒ½ä¼šè¢«å¤åˆ¶ã€‚
å¦‚æœèµ‹å€¼æœŸé—´å‡ºé”™ï¼Œä¾‹å¦‚å¦‚æœå±æ€§ä¸å¯å†™ï¼Œåˆ™ä¼šæŠ›å‡º `TypeError`ï¼›å¦‚æœåœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰å·²ç»æ·»åŠ äº†ä¸€äº›å±æ€§ï¼Œåˆ™è¿™äº›å±æ€§ä¼šè¢«ä¿ç•™ï¼Œè€Œ `target` å¯¹è±¡ä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚
`Object.assign()` ä¸ä¼šåœ¨æºå¯¹è±¡å€¼ä¸º `null` æˆ– `undefined` æ—¶æŠ›å‡ºé”™è¯¯ã€‚

```javascript
const obj = {
	name: 'apries',
	info: [20, 'Male', 'ChengDu'],
}

const obj1 = Object.assign({}, obj)

obj1.name = 'Apries'
obj1.info[2] = 'China'
console.log(obj)// { name: 'apries', info: [ 20, 'Male', 'China' ] }
console.log(obj1)// { name: 'Apries', info: [ 20, 'Male', 'China' ] }
```

### å±•å¼€è¿ç®—ç¬¦(...)
`...(å±•å¼€è¿ç®—ç¬¦)`æ˜¯$ES6$ç‰¹æ€§ï¼Œå®ƒæä¾›äº†ä¸`Object.assign()`ä¸€æ ·æ•ˆæœçš„ä½†æ›´ä¸ºç®€æ´çš„æµ…æ‹·è´æ–¹æ³•ã€‚
```javascript
const obj = {
	name: 'apries',
	info: [20, 'Male', 'ChengDu'],
}

const obj1 = { ...obj }

obj1.name = 'Apries'
obj1.info[2] = 'China'
console.log(obj) // { name: 'apries', info: [ 20, 'Male', 'China' ] }
console.log(obj1) // { name: 'Apries', info: [ 20, 'Male', 'China' ] }
```
### Array.prototype.concat()
>[!info]
>```javascript
concat()
concat(value0)
concat(value0, value1)
concat(value0, value1,..., valueN)
>```
>å¦‚æœçœç•¥äº†æ‰€æœ‰ valueN å‚æ•°ï¼Œåˆ™ concat ä¼šè¿”å›è°ƒç”¨æ­¤æ–¹æ³•çš„ç°å­˜æ•°ç»„çš„ä¸€ä¸ª**æµ…æ‹·è´**ã€‚

```javascript
const arr = [
	'apries',
	20,
	'Male',
	'ChengDu',
	{
		name: 'apries',
		info: [20, 'Male', 'ChengDu'],
	},
]

const arr1 = arr.concat()
arr1[0] = 'Apries'
arr1[4].name = 'Apries'
console.log(arr)
console.log(arr1)
/*
output:
[
  'apries',
  20,
  'Male',
  'ChengDu',
  { name: 'Apries', info: [ 20, 'Male', 'ChengDu' ] }
]
[
  'Apries',
  20,
  'Male',
  'ChengDu',
  { name: 'Apries', info: [ 20, 'Male', 'ChengDu' ] }
]
*/
```

### Array.prototype.slice()
>[!info]
>`slice()`æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡æ˜¯ä¸€ä¸ªç”± `start` å’Œ `end` å†³å®šçš„åŸæ•°ç»„çš„æµ…æ‹·è´ï¼ˆåŒ…æ‹¬ `start`ï¼Œä¸åŒ…æ‹¬ `end`ï¼‰ï¼Œå…¶ä¸­ `start` å’Œ `end` ä»£è¡¨äº†æ•°ç»„å…ƒç´ çš„ç´¢å¼•ã€‚åŸå§‹æ•°ç»„ä¸ä¼šè¢«æ”¹å˜ã€‚

```javascript
const arr = [
	'apries',
	20,
	'Male',
	'ChengDu',
	{
		name: 'apries',
		info: [20, 'Male', 'ChengDu'],
	},
]

const arr1 = arr.slice()
arr1[0] = 'Apries'
arr1[4].name = 'Apries'
console.log(arr)
console.log(arr1)
/*
output:
[
  'apries',
  20,
  'Male',
  'ChengDu',
  { name: 'Apries', info: [ 20, 'Male', 'ChengDu' ] }
]
[
  'Apries',
  20,
  'Male',
  'ChengDu',
  { name: 'Apries', info: [ 20, 'Male', 'ChengDu' ] }
]
*/
```

## å¦‚ä½•å®ç°ä¸€ä¸ªæ·±æ‹·è´
### JSON.parse(JSON.stringify())
åˆ©ç”¨`JSON.stringify()`å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œå†ä½¿ç”¨`JSON.parse()`ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚å°±äº§ç”Ÿäº†æ–°å¯¹è±¡ï¼Œå¹¶ä¸”ä¹‹ä¸ªæ–°å¯¹è±¡ä¼šå¼€è¾Ÿæ–°çš„ç©ºé—´ï¼Œä¸å†æœ‰å¼•ç”¨å½±å“ï¼Œä»è€Œå®ç°æ·±æ‹·è´ã€‚
```javascript
const arr = [
	'apries',
	20,
	'Male',
	'ChengDu',
	{
		name: 'apries',
		info: [20, 'Male', 'ChengDu'],
	},
]

const obj = {
	name: 'apries',
	info: [20, 'Male', 'ChengDu'],
}

const arr1 = JSON.parse(JSON.stringify(arr))
const obj1 = JSON.parse(JSON.stringify(obj))

arr1[4].name = 'Apries'
obj1.info[2] = 'China'

console.log(arr)
console.log(obj)

/*
output:
[
  'apries',
  20,
  'Male',
  'ChengDu',
  { name: 'apries', info: [ 20, 'Male', 'ChengDu' ] }
]
{ name: 'apries', info: [ 20, 'Male', 'ChengDu' ] }
*/
```

å¯¹æ•°ç»„å’Œå¯¹è±¡çš„æ·±æ‹·è´å¯ä»¥å¾ˆå¥½çš„å®ç°ï¼Œä½†æ˜¯ä¸èƒ½æ­£ç¡®å¤„ç†*å‡½æ•°*å’Œ*æ­£åˆ™*ã€‚
åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–å
- æ­£åˆ™ å˜ä¸º ç©ºå¯¹è±¡
- å‡½æ•° å˜ä¸º null
```javascript
const obj = {
	name: 'apries',
	sayHello: function () {},
	regex: RegExp(/^[a-zA-Z0-9]+$/),
}

const json = JSON.stringify(obj)
const obj1 = JSON.parse(JSON.stringify(obj))
console.log(json) // {"name":"apries","regex":{}}
console.log(obj1) // { name: 'apries', regex: {} }
```
### å¦‚ä½•æ‰‹å†™ä¸€ä¸ªæ·±æ‹·è´ï¼Ÿ
#### ä»æµ…æ‹·è´å¼€å§‹
```javascript
function clone(source) {
	let copied = {}
	for (const key in source) {
		copied[key] = source[key]
	}
	return copied
}
```
è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµ…æ‹·è´ã€‚
ä¸ºäº†å®ç°æ·±æ‹·è´ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°å¼•ç”¨ç±»å‹ï¼Œå¹¶ä¸”è·çŸ¥å¯¹è±¡çš„æ·±åº¦ã€‚
äºæ˜¯æˆ‘ä»¬ä½¿ç”¨é€’å½’æ¥è§£å†³
#### ç®€å•é€’å½’
ç¨å¾®å¯¹ç®€å•æµ…æ‹·è´ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œéµå¾ªä»¥ä¸‹é€’å½’åŸåˆ™ï¼š
- è‹¥`source`æ˜¯åŸå§‹ç±»å‹ï¼Œæ— éœ€ç»§ç»­æ‹·è´ï¼Œè¿”å›ã€‚
- è‹¥`source`æ˜¯å¼•ç”¨ç±»å‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œéå†`source`ï¼Œå°†å±æ€§ç»§ç»­æ‰§è¡Œ*æ·±æ‹·è´*
```javascript
function deepClone(source) {
	if (typeof source === 'object') {
		const copied = {}
		for (const key in source) {
			copied[key] = deepClone(source[key])
		}
		return copied
	}

	return source
}

const obj = {
	a: 1,
	b: {
		c: 2,
		d: [3, 4, 5],
	},
}

const copied = deepClone(obj)
console.log(copied) // { a: 1, b: { c: 2, d: { '0': 3, '1': 4, '2': 5 } } }
```

å¯ä»¥å‘ç°ï¼Œå·²ç»èƒ½æ‹·è´å¯¹è±¡ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ·»åŠ å¯¹æ•°ç»„çš„æ”¯æŒã€‚
æ€æ ·æ·»åŠ å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨`source`å¯¹è±¡ä¸ºæ•°ç»„æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºçš„`copied`å˜é‡ä»ä¸ºå¯¹è±¡
æˆ‘ä»¬ä»…éœ€è¦åœ¨`source`ä¸ºæ•°ç»„æ—¶ï¼Œåˆ›å»º`copied`ä¸ºç©ºæ•°ç»„å³å¯è§£å†³

#### æ”¯æŒæ•°ç»„
```javascript
function deepClone(source) {
	if (typeof source === 'object') {
		const copied = Array.isArray(source) ? [] : {}
		for (const key in source) {
			copied[key] = deepClone(source[key])
		}
		return copied
	}

	return source
}

const obj = {
	a: 1,
	b: {
		c: 2,
		d: [3, 4, 5],
	},
}

const copied = deepClone(obj)
console.log(copied) // { a: 1, b: { c: 2, d: [ 3, 4, 5 ] } }
```
#### å¾ªç¯å¼•ç”¨é—®é¢˜
åœ¨å¯¹è±¡çš„å±æ€§ä¸­å¦‚æœç›´æ¥æˆ–é—´æ¥çš„å¼•ç”¨çš„è‡ªèº«ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå¾ªç¯å¼•ç”¨é—®é¢˜ã€‚
æˆ‘ä»¬çš„æ·±æ‹·è´ä¼šæ— ç©·æ— å°½åœ°é€’å½’ä¸‹å»ï¼š
```javascript
function deepClone(source) {
	if (typeof source === 'object') {
		const copied = Array.isArray(source) ? [] : {}
		for (const key in source) {
			copied[key] = deepClone(source[key])
		}
		return copied
	}

	return source
}

const obj = {
	a: 1,
	b: {
		c: 2,
		d: [3, 4, 5],
	},
}
obj.e = obj

const copied = deepClone(obj)
```
æ­¤æ—¶æˆ‘ä»¬åœ¨`obj`ä¸­æ·»åŠ æ–°å±æ€§`e`å¹¶å¼•ç”¨è‡ªèº«
é€ æˆç»“æœï¼š
```shell
function deepClone(source) {
                  ^

RangeError: Maximum call stack size exceeded
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:1:19)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)
    at deepClone (D:\a.Work_Space\HTML_CODE\index.js:5:18)

Node.js v21.7.1
```
##### å¦‚ä½•è§£å†³ï¼Ÿ
ä¸ºäº†è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨é€’å½’è¿‡ç¨‹ä¸­å°±éœ€è¦åˆ¤æ–­å½“å‰æ‹·è´å¯¹è±¡`copied`ä¸æºå¯¹è±¡`source`çš„å¯¹åº”å…³ç³»æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯å¦å·²ç»æ‹·è´è¿‡è¿™æ ·çš„æ˜ å°„å…³ç³»ã€‚
äºæ˜¯å¼•å…¥ä¸€ä¸ªæ–°å­˜å‚¨ç©ºé—´æ¥å‚¨å­˜è¿™ç§å¯¹åº”å…³ç³»ï¼Œé‚£æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ€æ ·çš„å­˜å‚¨ç©ºé—´å‘¢ï¼Ÿ
- éœ€è¦èƒ½å­˜å‚¨æ˜ å°„å…³ç³»ã€‚
äºæ˜¯ä¾¿æƒ³åˆ°äº†`Map`å¯¹è±¡ã€‚å®ƒæ”¯æŒä¸€ä¸ª**é”®å€¼å¯¹**æ˜ å°„å…³ç³»ã€‚è€Œä¸”`key`å¯ä»¥æ˜¯å¼•ç”¨ç±»å‹ã€‚
```javascript
function deepClone(source, map = new Map()) {
	if (typeof source === 'object') {
		const copied = Array.isArray(source) ? [] : {}

		if (map.get(source)) return map.get(source)
		map.set(source, copied)

		for (const key in source) {
			copied[key] = deepClone(source[key], map)
		}
		return copied
	}

	return source
}

const obj = {
	a: 1,
	b: {
		c: 2,
		d: [3, 4, 5],
	},
}
obj.e = obj

const copied = deepClone(obj)
console.log(copied)

/*
output:
<ref *1> {
  a: 1,
  b: { c: 2, d: [ 3, 4, 5 ] },
  e: [Circular *1]
}
*/
```
ç°åœ¨æˆ‘ä»¬å‘ç°æ²¡æœ‰æŠ¥é”™äº†ã€‚
å¹¶ä¸”å¾ªç¯å¼•ç”¨çš„å±æ€§å€¼å˜ä¸ºäº†`[Circular *1]`ï¼Œå³ä¸ºå¾ªç¯å¼•ç”¨çš„æ„æ€
#### å¾ªç¯å¼•ç”¨-æ— æ³•é‡Šæ”¾
åœ¨JSçš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸­ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å¼ºå¼•ç”¨äº†(å³å¯åˆ°è¾¾)ï¼Œå°±æ— æ³•è¢«åƒåœ¾å›æ”¶ã€‚
å¦‚æœæˆ‘ä»¬ä½¿ç”¨`Map`æ¥å­˜å‚¨ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„æ˜ å°„æ˜¯å­˜åœ¨å¼ºå¼•ç”¨çš„ï¼Œæ— æ³•è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ï¼Œé€ æˆäº†å†…å­˜èµ„æºçš„æµªè´¹ã€‚

è¿™æ—¶ï¼Œæˆ‘ä»¬ä¾¿æå‡ºä½¿ç”¨`WeakMap`ã€‚
é¡¾åæ€ä¹‰ï¼š
>[!info]
>ä¸€ä¸ªå¯¹è±¡ä½œä¸º WeakMap çš„é”®å­˜åœ¨ï¼Œä¸ä¼šé˜»æ­¢è¯¥å¯¹è±¡è¢«åƒåœ¾å›æ”¶ã€‚ä¸€æ—¦ä¸€ä¸ªå¯¹è±¡ä½œä¸ºé”®è¢«å›æ”¶ï¼Œé‚£ä¹ˆåœ¨ WeakMap ä¸­ç›¸åº”çš„å€¼ä¾¿æˆä¸ºäº†è¿›è¡Œåƒåœ¾å›æ”¶çš„å€™é€‰å¯¹è±¡ï¼Œåªè¦å®ƒä»¬æ²¡æœ‰å…¶ä»–çš„å¼•ç”¨å­˜åœ¨ã€‚

ä»£ç æ— å…¶ä»–å˜åŠ¨ï¼Œå°†`new Map()`æ›¿æ¢ä¸º`new WeakMap()`å³å¯

#### æ€§èƒ½ä¼˜åŒ–
ç”±äºæˆ‘ä»¬çš„ä»£ç ä¸­æ‹¥æœ‰å¾ªç¯ï¼Œè¿™å¸¸å¸¸ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚
å®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨çš„`for in`å¾ªç¯åœ¨éå†æ—¶çš„æ•ˆç‡æ˜¯éå¸¸ä½çš„ã€‚
æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹å¸¸è§çš„ä¸‰ç§å¾ªç¯`for`ã€`while`ã€`for in`çš„æ‰§è¡Œæ•ˆç‡:
```javascript
const arr = new Array(100000).fill(0)

const len = arr.length
let i = 0
sum = 0
console.time('while')
while (i < len) {
	const ele = arr[i]
	sum += ele
	i++
}
console.timeEnd('while') // while: 1.82ms

console.time('forin')
for (const key in arr) {
	const ele = arr[key]
	sum += ele
}
console.timeEnd('forin') // forin: 7.245ms

console.time('for')
for (let i = 0; i < len; i++) {
	const ele = arr[i]
	sum += ele
}
console.timeEnd('for') // for: 0.815ms
```

é€šè¿‡å¤šæ¬¡æµ‹è¯•ï¼Œæˆ‘è¿™é‡Œå‘ç°`for`å¾ªç¯çš„æ•ˆç‡æœ€ä½³(åœ¨å…¶ä»–åšå®¢ä¸­æåˆ°çš„`while`å¾ªç¯æ•ˆç‡æœ€ä½³å°šä¸å¾—è€ŒçŸ¥å…¶ä¸­æƒ…å†µ)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†é€’å½’ä¸­çš„`for in`æ”¹ä¸º`for`éå†ã€‚
```javascript
for (const key in source) {
	copied[key] = deepClone(source[key], map)
}
```

æˆ‘ä»¬é€šè¿‡`Object.keys()`æ‹¿åˆ°é”®æ•°ç»„ï¼Œå³å¯ä¿®æ”¹ä¸º`for`éå†
```javascript
const keys = Object.keys(source)
for (let i = 0; i < keys.length; i++) {
	const key = keys[i]
	copied[key] = deepClone(source[key], map)
}
```

ä¼˜åŒ–åçš„æ•´ä½“`deepClone`ä»£ç å¦‚ä¸‹
```javascript
function deepClone(source, map = new WeakMap()) {
	if (typeof source === 'object') {
		const copied = Array.isArray(source) ? [] : {}

		if (map.get(source)) return map.get(source)
		map.set(source, copied)

		const keys = Object.keys(source)
		for (let i = 0; i < keys.length; i++) {
			const key = keys[i]
			copied[key] = deepClone(source[key], map)
		}
		return copied
	}

	return source
}
```

ä½†æ˜¯å…¶å®é—®é¢˜éšä¹‹è€Œæ¥ï¼Œæˆ‘ä»¬ä¸Šè¿°æåˆ°ï¼Œä½¿ç”¨JSONå¯¹è±¡çš„ç®€æ˜“æ·±æ‹·è´æ–¹æ³•å¯¹å‡½æ•°å’Œå…¶ä»–æ•°æ®å¯¹è±¡çš„æ”¯æŒåº¦ä¸ä½³ã€‚æˆ‘ä»¬å†™çš„æ·±æ‹·è´ä¼¼ä¹ä¹Ÿä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
#### æ›´åˆç†çš„åˆ¤æ–­ç±»å‹
##### å¦‚ä½•è·å–æ•°æ®ç±»å‹ï¼Ÿ
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`toString`æ–¹æ³•æ¥å‡†ç¡®çš„è·å–å¼•ç”¨ç±»å‹ï¼š
>[!info]
>æ¯ä¸ªå¼•ç”¨ç±»å‹éƒ½æœ‰`toString`æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`toString`æ–¹æ³•è¢«æ¯ä¸ª`Object`å¯¹è±¡ç»§æ‰¿ã€‚å¦‚æœæ­¤æ–¹æ³•åœ¨è‡ªå®šä¹‰å¯¹è±¡ä¸­æœªè¢«äººä¸ºè¦†ç›–ï¼Œåˆ™`toString()`è¿”å›`[Object type]`ï¼Œå…¶ä¸­`type`æ˜¯å¯¹è±¡çš„ç±»å‹ã€‚

ä¸‹é¢ç½—åˆ—ä¸€äº›ç»å¸¸ä½¿ç”¨çš„ç±»å‹çš„`toString()`è¿”å›å€¼
```javascript
// åŸºæœ¬å¯¹è±¡
const ObjectTag = '[object Object]'
const FunctionTag = '[object Function]'
const BooleanTag = '[object Boolean]'
const SymbolTag = '[object Symbol]'

// æ•°å­—å’Œæ—¥æœŸå¯¹è±¡
const NumberTag = '[object Number]'
const BigIntTag = '[object BigInt]'
const MathTag = '[object Math]'
const DateTag = '[object Date]'

// å­—ç¬¦ä¸²
const StringTag = '[object String]'
const RegExpTag = '[object RegExp]'

// å¯å¼•ç”¨çš„é›†åˆå¯¹è±¡
const ArrayTag = '[object Array]'

// ä½¿ç”¨é”®çš„å¯¹è±¡
const MapTag = '[object Map]'
const SetTag = '[object Set]'
const WeakMapTag = '[object WeakMap]'
const WeakSetTag = '[object WeakSet]'

// ç»“æ„åŒ–å¯¹è±¡
const ArrayBufferTag = '[object ArrayBuffer]'
const JSONTag = '[object JSON]'
```

ä¸Šé¢çš„ç±»å‹ä¸­ï¼Œæˆ‘ä»¬ç®€å•åœ°å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š
- å¯ç»§ç»­éå†çš„
- ä¸ç»§ç»­å¯éå†çš„
##### å¯ç»§ç»­éå†çš„ç±»å‹

ä¸Šé¢æˆ‘ä»¬å·²ç»è€ƒè™‘çš„`Object`ã€`Array`éƒ½å±äºå¯éå†ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬çš„å†…éƒ¨éƒ½è¿˜å¯ä»¥å­˜å‚¨å…¶å®ƒç±»å‹çš„æ•°æ®ã€‚å¦å¤–è¿˜æœ‰`Map`ã€`Set`ç­‰éƒ½æ˜¯å¯ä»¥ç»§ç»­éå†çš„ç±»å‹ã€‚è¿™é‡Œæˆ‘ä»¬åªè®¨è®ºè¿™å››ç§ã€‚

æˆ‘ä»¬å…ˆåˆ©ç”¨åŸå‹é“¾çŸ¥è¯†ï¼Œæ‹¿åˆ°å…¶æ„é€ å‡½æ•°ã€‚
```javascript
function getInitData(source) {
	const Init = source.constructor
	return new Init()
}
```


å®ç°ä»£ç å¦‚ä¸‹:
```javascript
const ObjectTag = '[object Object]'
const ArrayTag = '[object Array]'
const MapTag = '[object Map]'
const SetTag = '[object Set]'
function getInitData(source) {
	const Init = source.constructor
	return new Init()
}
function deepClone(source, map = new WeakMap()) {
	// ä»…æ·±æ‹·è´åŸå§‹ç±»å‹
	if (typeof source !== 'object' || source === null) return source

	// å…¶ä»–éƒ½æ˜¯å¼•ç”¨ç±»å‹

	// åˆå§‹åŒ–
	const copied = getInitData(source)
	// è·å–ç±»å‹
	const type = Object.prototype.toString.call(source)

	// é˜²æ­¢å¾ªç¯å¼•ç”¨
	if (map.get(source)) return map.get(source)
	map.set(source, copied)

	switch (type) {
		case SetTag: // å…‹éš†Set
			source.forEach((value) => copied.add(deepClone(value, map)))
			return copied
		case MapTag: // å…‹éš†Map
			source.forEach((value, key) => copied.set(key, deepClone(value, map)))
			return copied
		case ArrayTag: // å…‹éš†æ•°ç»„
			for (let i = 0; i < source.length; i++) {
				copied[i] = deepClone(source[i], map)
			}
			return copied
		case ObjectTag: // å…‹éš†å¯¹è±¡
			const keys = Object.keys(source)
			for (let i = 0; i < keys.length; i++) {
				const key = keys[i]
				copied[key] = deepClone(source[key], map)
			}
			return copied
		default:
			throw new Error('æš‚ä¸æ”¯æŒçš„ç±»å‹:ã€Œ' + type + 'ã€')
	}
}

const obj = {
	field1: 1,
	field2: undefined,
	field3: {
		child: 'child',
	},
	field4: [2, 4, 8],
	empty: null,
	map: new Map([
		['key1', 'value1'],
		['key2', 'value2'],
	]),
	set: new Set([1, 2, 3]),
}

const copied = deepClone(obj)
console.log(copied)
```

##### å…‹éš†å‡½æ•°
æœ‰ç‚¹éš¾ï¼Œåé¢å†™å˜»å˜»(ğŸ˜)
