# Webpack 流程解释

## 初始化阶段

### 1. 初始化参数

从**配置文件**,**配置对象**, **命令行参数**种读取，与默认配置结合得出最终的参数

### 2. 创建编译器对象
用上一步得到的参数创建**`compiler`**对象

### 3. 初始化编译环境

包括了:
- 注入内置插件
- 注册模块工厂
- 初始化 RuleSet 集合
- 加载配置插件

### 4. 开始编译

执行`compiler`对象的`run`方法，开始编译流程

### 5. 确定入口

根据配置文件中的`entry`找出所有的入口文件，调用`compilation.addEntry`将入口文件转换为`dependence`对象

## 构建阶段

### 1. 编译模块
根据`entry`对应的`dependence`创建`module`对象，调用`loader`对模块转义为标准JS内容,调用JS解释器将内容转换为AST对象，从中找出模块的依赖模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理

### 2. 完成模块编译

上一步递归处理所有能到达的模块后，得到了每个模块被翻以后的内容以及他们之间的**依赖关系图**

## 输出阶段

### 1. 输出资源

根据入口和模块之前的依赖关系，组装成一个一个包含多个模块的`Chunk`，再把每一个`Chunk`转换成一个单独的文件加入到输出列表，这步是可以修改输出内容的最后机会

### 2. 写入文件

在确定好输出内容之后，根据配置确定输出的路径和文件名，将文件内容写入到文件系统


# Chunk 

由于 chunk 的生成规则：
- entry 及 entry 触及的模块, 生成一个 chunk
- 动态引入的模块，各自组成一个 chunk

所以， 一个多页面应用种，所有页面都依赖于相同的库的话，就造成了不必要的重复下载，所以可以将这些库打包成一个 chunk，然后在入口处加载。

webpack 为我们提供了 `commonsChunkPlugin` 和 `splitChunksPlugin`, 允许我们优化 `chunks` 结构



